# 《天机变》项目开发核心约束与演化指南

**文档版本: 2.0**
**生效日期: 2025-09-27**

## 1. 总则 (General Principle)

本文件旨在为所有参与《天机变》项目的开发者（包括人类与AI代理）提供一套不可动摇的核心设计约束与开发流程指南。在进行任何原型开发、功能实现或AI探索之前，必须将本文件及其中引用的核心文档视为项目的“宪法”和“单一事实来源”。

**任何偏离核心约束的行为，都被视为是错误的，** 除非通过第4节定义的“设计变更控制流程”进行正式修订。

---

## 2. 核心约束文件 (Core Constraint Documents)

### 2.1. 逻辑引擎蓝图: `card_logic_schema.md` (版本 3.0)

- **约束**: 这是游戏逻辑引擎的**唯一**蓝图。所有卡牌效果的实现，都**必须**能够被此 `v3.0` 版本的 schema 所描述和驱动。
- **禁止**: 禁止绕过此 schema 在游戏引擎中对卡牌效果进行硬编码。

### 2.2. 游戏规则法典: `game_rules.md` (版本 2.0)

- **约束**: 这是游戏的**最终**规则集。所有游戏行为的裁定，都**必须**严格遵循此 `v2.0` 版本中的定义。
- **特别强调**:
    - **第 7.1 节 “金科玉律”**: 效果结算的六级优先级是处理所有冲突的最高准则，不可违背。
    - **第 7.2 节 “核心术语定义”**: “伤害”/“损失”、“代价”/“惩罚”等术语的区分是强制性的。

### 2.3. 卡牌设计总纲: `hexagram_interpretations.md` (版本 2.0)

- **约束**: 这是全部64张基础卡牌**唯一**的设计意图和效果描述文档。在新的平衡性问题被证实前，应视其为设计的最终形态。

---

## 3. 开发路径指引 (Guideline for Development)

下一步的核心任务是**“在约束下进行原型验证”**，而非“对约束本身进行再创造”。
1.  **构建最小可行引擎 (Minimum Viable Engine)**: 优先实现 `card_logic_schema.md` 中最核心的动作。
2.  **测试高风险卡牌**: 优先实现和测试机制最独特的卡牌（如《蹇》、《革》、《屯》），以验证引擎的鲁棒性。
3.  **迭代与反馈**: 在严格遵守规则的前提下，通过大量模拟对局来发现新的“涌现”问题。

---

## 4. 设计演化流程 (Design Evolution Process) - V2.0 新增

为了让约束体系保持生命力，所有对核心约束文件的修改，都必须遵循以下流程。

### 4.1. 设计变更控制流程

- **版本控制**: 对核心文档的任何修改，都应通过代码仓库的**分支 (Branch)** 和 **拉取请求 (Pull Request)** 来进行。
- **设计评审**: 每一项修改都必须在PR中详细说明其**“修改原因 (Why)”**——是为了修复哪个新发现的漏洞？是为了调整哪个失衡的指标？
- **审批机制**: 必须由指定的项目负责人或设计委员会来**审批 (Approve)** 这些设计变更的PR后，才能合入主干。

### 4.2. 约束自动化：卡牌数据校验器 (Card Data Linter)

- **要求**: 必须开发一个独立的校验脚本。该脚本的功能是读取一个卡牌的 `.json` 文件，并根据 `card_logic_schema.md` 的规则进行格式验证。
- **目的**: 在设计和开发阶段，能即时发现数据格式错误，确保所有卡牌数据都严格遵守逻辑引擎的规范，极大地提升效率和质量。

### 4.3. 量化平衡目标 (Quantitative Balance Targets)

- **要求**: 在原型测试和后续运营阶段，必须建立数据监控和分析系统，追踪以下（但不限于）关键性能指标（KPIs）：
    - **胜率分布**: 各【本命卦】、各【基础牌】的胜率是否处于可接受区间（例如，40%-60%）。
    - **使用频率**: 是否存在无人问津或必选的卡牌。
    - **游戏时长**: 平均对局时长是否符合设计预期。
    - **资源曲线**: 玩家在游戏进程中的资源获取/失去曲线是否健康。
- **目的**: 以客观数据为依据，来驱动后续的平衡性调整，使设计讨论从“主观感觉”提升到“数据驱动”。

---

## 5. V2.1 引擎开发核心指令：采纳简化优先级模型 (Engine Dev Core Directive: Adopt Simplified Priority Model)

**背景:** `game_rules.md` 中的 “金科玉律” 定义了一个包含六个层级的效果结算优先级系统。该文档同时指出，此系统在代码中实现起来极为复杂，是潜在的BUG温床。

**指令:**
- **采纳简化模型:** 为降低项目初期的开发风险、加快原型迭代速度，**所有初版游戏引擎的开发，都必须采纳** `game_rules.md` 中推荐的 **三层简化优先级模型**。
    1.  **禁制层 (Cannot-Layer):** 包含所有“不能/无法”的规则。
    2.  **规则变更层 (Rules-Change-Layer):** 包含所有改变游戏基础规则的效果。
    3.  **常规效果层 (Standard-Layer):** 包含所有其他的即时效果和状态。
- **目标:** 此举旨在优先确保游戏核心循环的稳定性和可测试性。在游戏原型得到充分验证、核心玩法稳定之后，再根据实际的游戏涌现问题，评估是否有必要升级到完整的六层模型。
- **状态:** **此指令立即生效。**

---
此 `AGENTS.md` 文件的存在，旨在确保项目在创新的同时，不会偏离其稳定、自洽的核心，并为其健康演化提供清晰的路径。