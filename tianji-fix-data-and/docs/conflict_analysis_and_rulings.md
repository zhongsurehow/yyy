# 《天机变》 - 复杂交互冲突分析与裁定建议

**文档版本: 1.0**
**日期: 2025-09-28**

## 1. 简介

本文档旨在主动识别、分析并为游戏中潜在的复杂卡牌效果交互提供清晰的裁定建议。其目的是作为`game_rules.md`的补充，为游戏引擎开发者在实现具体逻辑时提供指导，确保游戏行为的一致性、可预测性，并减少潜在的逻辑漏洞。

所有裁定均基于`game_rules.md` V2.0中定义的三层优先级模型。

---

## 2. 高风险交互分析

### 2.1. 永久性规则变更：《革》卦

- **卡牌效果:** 《革》卦【天部】(君子豹变) 的效果为：“从下一轮开始，回合顺序反转”。这是一个永久性的全局规则修改。
- **潜在风险:**
    1.  **效果堆叠:** 如果有多张《革》被打出，会发生什么？
    2.  **优先级冲突:** 如果有其他卡牌（未来可能加入）也试图修改回合顺序，如何裁定？

- **裁定建议:**
    1.  **优先级:** 根据`game_rules.md`，此效果属于 **层级二：规则变更层 (Rules-Change-Layer)**，具有高优先级。
    2.  **状态标记:** 引擎在处理此效果时不应简单地翻转一个布尔值（`isReversed = !isReversed`），而应将其视为一个**具名全局状态**，例如`GLOBAL_RULE_TURN_ORDER_REVERSED`。
    3.  **裁定逻辑:**
        *   当《革》的效果触发时，游戏系统检查是否存在`GLOBAL_RULE_TURN_ORDER_REVERSED`状态。
        *   如果**不存在**，则施加该状态，回合顺序从下一轮开始反转。
        *   如果**已存在**，则此效果**不产生额外效果**。即，第二次打出《革》不会将顺序“反转回来”。
        *   要移除此效果，必须由另一个具有同等或更高优先级的、明确注明“移除回合顺序反转规则”的效果来实现。

---

### 2.2. 效果复制与效果劫持：《坤》 vs 《蒙》

- **场景描述:**
    1.  **玩家A** 打出一张基础牌，例如《大壮》（造成4点伤害）。此效果进入结算链。
    2.  **玩家B** （《蒙》的持有者）响应玩家A，打出《蒙》卦，选择指定玩家A，劫持其《大壮》的效果。
    3.  **玩家C** （《坤》的持有者，本回合未移动）在《蒙》的效果结算前，响应玩家A，打出《坤》卦的【人部】(收敛)效果，试图复制“上一位行动的玩家（即玩家A）已解读的基础爻辞效果”。

- **核心问题:** 玩家C的《坤》卦复制的是什么？
    - **选项1:** 复制玩家A原始的《大壮》效果（造成4点伤害）。
    - **选项2:** 复制玩家B《蒙》卦将要产生的最终结果。

- **分析:**
    - 《坤》的JSON定义为复制`"type": "LAST_BASIC_CARD_EFFECT_PLAYED"`。这里的关键是“PLAYED”的定义。
    - 《蒙》的效果是`APPLY_STATUS`，施加一个`MONTORIAL_FOG`状态。这个状态会**中断**原始效果的结算，并用一个`CHOICE`（教化或惩戒）来替代它。
    - 根据`game_rules.md`中关于响应和中断的规则，效果结算应该形成一个“堆栈”或“链条”。后发动的效果先结算。
    - 在此场景中，结算顺序是：玩家C的《坤》 -> 玩家B的《蒙》 -> 玩家A的《大壮》。

- **裁定建议:**
    - **“最后已结算的效果”原则:** `COPY_EFFECT`动作的目标应该是**在效果链上最终实际发生的、且已结算完毕的效果**。
    - **具体裁定:**
        1.  当轮到玩家C的《坤》结算时，它会去查找“上一位已结算的基础牌效果”。然而，在它结算的这一刻，玩家A的《大壮》和玩家B的《蒙》都还**未结算**。因此，它应该复制的是**在本回合中，它之前已经完整结算的最后一个基础牌效果**。
        2.  **修正场景**：为了更好地说明问题，我们调整一下时机。**玩家A**打出《大壮》，效果结算完毕。然后轮到**玩家B**行动，他打出《坤》试图复制玩家A的效果。此时，**玩家C**响应玩家B的《坤》，打出《蒙》来劫持《坤》的效果。
        3.  **新场景裁定**：
            *   《蒙》的效果先结算，它劫持了《坤》的`COPY_EFFECT`动作。
            *   《蒙》的玩家可以选择【教化】（允许《坤》正常结算）或【惩戒】（无效化《坤》的效果，改为惩罚）。
            *   如果选择【教化】，则《坤》的效果继续结算，它会正确地复制玩家A的《大壮》效果。
            *   如果选择【惩戒】，则《坤》的`COPY_EFFECT`动作被无效，**什么也不发生**。玩家B（《坤》的使用者）将承受惩罚。
    - **结论:** 效果的复制/劫持目标必须是**已经发生或正在发生**的事件。引擎应严格遵循效果结算堆栈，一个效果只能影响在其之后结算的效果。`COPY_EFFECT`在结算时，会寻找**已经完成结算**的事件作为源。

---

## 3. 初步平衡性审查与调整

在将所有占位卡牌填充完毕后，进行了一轮初步的宏观平衡性审查。目标是修正那些明显过强、过弱或成本收益严重不匹配的效果，为后续的真人对战测试提供更合理的基线。

以下是具体的调整记录：

### 3.1. 《大有》 (basic_14_da_you) - 收益削减

- **原效果【天部】:** "你获得12金币，但必须展示给所有玩家看。"
- **问题分析:** 12金币是游戏中单次无成本获得的最高收益之一，强度过高。此外，其JSON定义中的`"source": "REVEALED"`参数在`card_logic_schema.md`中并未定义，属于无效数据。
- **调整方案:**
    - 将金币收益从12降低至**10**。
    - 移除无效的`source`参数，使其符合数据规范。
- **目的:** 在保留其“大获”主题的同时，使收益回归到一个更平衡的水平，并修正数据错误。

### 3.2. 《大过》 (basic_28_da_guo) - 风险重塑

- **原效果【天部】:** "弃掉所有手牌和一半金币，对所有其他玩家造成6点伤害。"
- **问题分析:** 此效果的代价极其高昂（可能失去所有手牌和大量金币），属于典型的“自我毁灭式”设计，玩家几乎在任何情况下都不会选择使用，使其成为一张“废卡”。
- **调整方案:**
    - 将代价从“弃掉所有手牌和一半金币”修改为“**弃掉3张手牌**”。
    - 将伤害从6点微调至**5点**。
- **目的:** 保留其“高风险、高回报”的AOE伤害特性，但将风险控制在一个可接受的范围内，增加了卡牌的可用性和策略价值。

### 3.3. 《既济》 (basic_63_jiji) - 奖励统一化

- **原效果【爻辞变体】:** 达成苛刻的胜利条件后，根据所在位置分别获得“20金币”、“3张功能牌”或“令所有对手失去10金币”的额外奖励。
- **问题分析:** 作为一张高难度的胜利条件卡，其奖励应具有足够的吸引力和一致性。目前不同爻辞的奖励价值差异较大，且“令对手失去10金币”相比直接获得收益，在游戏终局时的价值较低。
- **调整方案:**
    - 将所有三个爻辞变体的额外奖励，统一修改为更丰厚且一致的“**额外获得30金币**”。
- **目的:** 强化达成这一高难度目标后的成就感和实际收益，使其成为一个值得玩家去追求的战略目标。

---

## 4. 系统一致性验证

### 4.1. 既有风险报告 (`risk_report.md`) 复核

- **结论:** 对既有风险报告的审查确认，我填充和修改的卡牌效果（特别是`MODIFY_RULE`, `EXECUTE_LATER`等）确实引入了报告中指出的高风险模式。然而，由于我尚未按报告建议为这些动作添加`scope`, `expiry_time`等安全参数，这些风险在数据层面**仍然存在**。
- **行动:** 本次审查的主要目标是完成内容填充和逻辑梳理。上述高风险模式的加固将作为下一步引擎开发前必须解决的核心任务。本报告的创建和分析即是解决此问题的第一步。

### 4.2. 游戏地图 (`game_map.html`) 一致性审查

- **结论:** 游戏地图的结构由其内部的`mapData`对象数据驱动生成，其区域划分（三部、八宫）和邻接规则（天、人、地、中宫的连接方式）与`game_rules.md`中的定义完全一致。
- **行动:** 地图设计稳健，为卡牌效果（如移动、区域检测）的实现提供了清晰、可靠的数据基础。**无需修改**。